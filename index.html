<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Gift Effect Engine</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: transparent;
  overflow: hidden;
}

.effect-item {
  position: absolute;
  pointer-events: none;
  will-change: transform, width;
}
</style>
</head>
<body>

<script>
/* ==============================
   ğŸ ã‚®ãƒ•ãƒˆæ¼”å‡º å®šç¾©ã‚¨ãƒªã‚¢
   ã“ã“ã ã‘ç·¨é›†ã™ã‚Œã°å¢—ã‚„ã›ã‚‹
================================ */
const GIFT_EFFECTS = {
  baseball: {
    tiktokName: "Baseball",
    image: "Baseball.png",

    countLimit: 30,
    duration: 3000,

    start: {
      x: [0.2, 0.8],
      y: [0.7, 0.9],
      size: [80, 100]
    },

    end: {
      x: [0.0, 1.0],
      y: [0.0, 0.3],
      size: [80, 100]
    },

    motion: {
      type: "linear"
    }
  },

  surprised_fish: {
    tiktokName: "Surprised Fish",
    image: "Surprised_Fish.png",

    countLimit: 20,
    duration: 3500,

    start: {
      x: [0.3, 0.7],
      y: [0.6, 0.8],
      size: [90, 110]
    },

    end: {
      x: [0.45, 0.55],
      y: [0.2, 0.4],
      size: [140, 160]
    },

    motion: {
      type: "easeOut"
    }
  }
};

/* ==============================
   ğŸ”§ å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
================================ */
const rand = (a, b) => Math.random() * (b - a) + a;

function easing(type, t) {
  if (type === "easeOut") {
    return 1 - Math.pow(1 - t, 3);
  }
  return t; // linear
}

/* ==============================
   ğŸ“¥ URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å–å¾—
================================ */
const params = new URLSearchParams(location.search);
const giftKey = params.get("gift") || "baseball";
const rawCount = parseInt(params.get("n")) || 1;

const effect = GIFT_EFFECTS[giftKey] || GIFT_EFFECTS.baseball;
const COUNT = Math.min(rawCount, effect.countLimit);

/* ==============================
   ğŸ–¥ ç”»é¢ã‚µã‚¤ã‚º
================================ */
const W = document.documentElement.clientWidth;
const H = document.documentElement.clientHeight;

/* ==============================
   ğŸ¨ ã‚¢ã‚¤ãƒ†ãƒ ç”Ÿæˆ
================================ */
const items = [];

for (let i = 0; i < COUNT; i++) {
  const img = document.createElement("img");
  img.src = effect.image;
  img.className = "effect-item";

  const startSize = rand(...effect.start.size);

  const item = {
    el: img,

    sx: rand(effect.start.x[0] * W, effect.start.x[1] * W),
    sy: rand(effect.start.y[0] * H, effect.start.y[1] * H),

    ex: rand(effect.end.x[0] * W, effect.end.x[1] * W),
    ey: rand(effect.end.y[0] * H, effect.end.y[1] * H),

    ss: startSize,
    es: rand(...effect.end.size)
  };

  img.style.left = item.sx + "px";
  img.style.top  = item.sy + "px";
  img.style.width = startSize + "px";

  document.body.appendChild(img);
  items.push(item);
}

/* ==============================
   ğŸ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
================================ */
const startTime = performance.now();

function animate(now) {
  const t = Math.min((now - startTime) / effect.duration, 1);
  const p = easing(effect.motion.type, t);

  items.forEach(it => {
    const x = it.sx + (it.ex - it.sx) * p;
    const y = it.sy + (it.ey - it.sy) * p;
    const size = it.ss + (it.es - it.ss) * p;

    it.el.style.left = x + "px";
    it.el.style.top  = y + "px";
    it.el.style.width = size + "px";
  });

  if (t < 1) {
    requestAnimationFrame(animate);
  }
}

requestAnimationFrame(animate);
</script>

</body>
</html>
